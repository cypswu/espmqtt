<!--
===============================================================================
å“èŒ¶ QR Code ç®¡ç†ç³»çµ± â€§ ç¨‹å¼èªªæ˜æ–‡ä»¶  
Version : 1.4.0 (2025-04-30)
Author  : lung / ChatGPT-o3 collaborative draft  
License : MIT (å¯è‡ªç”±æ”¹ä½œï¼Œè«‹ä¿ç•™ç‰ˆæ¬Šèˆ‡æˆæ¬Šæ¢æ¬¾)

â–ä¸€ã€åŠŸèƒ½ç¸½è¦½
  1. âœï¸  è¡¨å–®è¼¸å…¥ â€” ä¸€æ¬¡å¡«å¯« 26 é …èŒ¶è‘‰è³‡è¨Šï¼‹ç”¢å“åœ–ç‰‡ï¼ˆæ”¯æ´æª”æ¡ˆæˆ–ç¶²å€ï¼‰ã€‚
  2. ğŸ“·  QR Code ç”¢ç”Ÿ â€” å°‡ JSON å£“ç¸®æˆ Base64 å¾Œç”¨ QRious ç”Ÿæˆï¼Œ
         è‡ªå‹•æª¢æ¸¬å®¹é‡ (â‰ˆ 2.9 KB ä¸Šé™)ï¼Œè¶…é™å³æç¤ºç²¾ç°¡å…§å®¹ä¸¦ fallbackã€‚
  3. ğŸ’¾  QR Code å„²å­˜ â€” æ”¯æ´ File System Access APIï¼Œ
         å½ˆå‡ºã€Œå¦å­˜ç‚ºã€è¦–çª—ï¼›ä¸æ”¯æ´æ™‚è‡ªå‹•è½‰å‚³çµ±ä¸‹è¼‰ã€‚
  4. ğŸ”„  QR Code è¼‰å…¥ â€” æª”æ¡ˆé¸æ“‡å™¨è§£æ QR åœ–ç‰‡ï¼Œå…ˆå˜—è©¦ decompressFromBase64()ï¼Œ
         å¤±æ•—æ™‚å† atob()ï¼Œä¸¦æ­£ç¢ºå›å¡«è¡¨å–®æ¬„ä½åŠåŒæ­¥æ›´æ–° QRã€‚
  5. ğŸ”  QR Code æƒæ â€” æ¡ç”¨ Html5QrcodeScannerï¼›
         é è¨­å„ªå…ˆã€ŒCamera 2.0 â†’ å¾Œé¡é ­ â†’ ç¬¬ä¸€é¡é ­ã€ã€‚
         è§£æå¾Œä»¥ä¸­æ–‡åˆ—è¡¨é¡¯ç¤ºæ‰€æœ‰æ¬„ä½ï¼Œä¸¦å¯é è¦½åœ–ç‰‡ã€‚
  6. ğŸ¨  UI ç¾å­¸ â€” èŒ¶è‘‰é…è‰²ã€å„ªé›…è¥¯ç·šå­—é«”ã€æŸ”å’Œé™°å½±èˆ‡é€²å ´å‹•ç•«ï¼›
         Debug å€å¯æ”¶åˆï¼Œæ–¹ä¾¿é–‹ç™¼èˆ‡æ­£å¼éƒ¨ç½²åˆ‡æ›ã€‚
  7. ğŸ› ï¸  å¯ç¶­è­·æ€§ â€” è¡¨å–®æ¬„ä½ã€fields é™£åˆ—ã€labelMap å°ç…§åŠ
         CSS è‰²ç¥¨é›†ä¸­ç®¡ç†ï¼›è¨»è§£æ¨™ç¤ºé—œéµä¿®æ”¹é»ã€‚

â–äºŒã€å¿«é€Ÿä½¿ç”¨  
  â‘  é›™æ“Š `index.html` æˆ–éƒ¨ç½²æ–¼ HTTPS / localhostã€‚  
  â‘¡ åœ¨ã€Œç”¢ç”Ÿ QR Codeã€åˆ†é è¼¸å…¥è³‡æ–™ â†’ æŒ‰ã€Œç”¢ç”Ÿ QR Codeã€ã€‚  
  â‘¢ æŒ‰ã€Œå„²å­˜ QR Codeã€æˆ–ã€Œè¼‰å…¥ QR Codeã€æŒ‰éˆ•åŸ·è¡Œæ“ä½œã€‚  
  â‘£ åˆ‡æ›ã€Œæƒæ QR Codeã€åˆ†é  â†’ æˆæ¬Šç›¸æ©Ÿ â†’ å°æº– QR å³å¯æŸ¥çœ‹çµæœã€‚

â–ä¸‰ã€ç¶­è­·è¦é»
  â€¢ æ–°å¢æˆ–åˆªæ¸›æ¬„ä½æ™‚ï¼Œæ›´æ–° `fields[]`ã€`labelMap{}` åŠ `<form>`ã€‚  
  â€¢ å£“ç¸®/è§£å£“é‚è¼¯é›†ä¸­æ–¼ `submit` èˆ‡ `load-btn` äº‹ä»¶ã€‚  
  â€¢ å¦‚éœ€å…¶å®ƒæª”æ¡ˆé¡å‹ï¼Œæ“´å…… `showSaveFilePicker.types`ã€‚

â–å››ã€æ ¸å¿ƒæª”æ¡ˆçµæ§‹
  â€¢ HTML è¡¨å–®            â†’ id å¿…é ˆåˆ—å…¥ JS `fields[]`ï¼›  
  â€¢ JS `fields[]`        â†’ æ§åˆ¶è¼¸å‡ºæ¬„ä½ï¼›  
  â€¢ JS `labelMap{}`      â†’ è‹±æ–‡éµ â†” ä¸­æ–‡æ¬„ä½åï¼›  
  â€¢ CSS `:root` è®Šæ•¸     â†’ ä¸»é¡Œè‰²ç¥¨ï¼›  
  â€¢ `defaultCamId()`     â†’ é¡é ­å„ªå…ˆè¨­å®šï¼›  
  â€¢ `level:'M'`          â†’ QR å®¹éŒ¯ç­‰ç´šï¼›

â–äº”ã€ç‰ˆæœ¬ç´€éŒ„
  v1.4.0 (2025-04-30)
    â€¢ feat: å®Œæ•´ 26 æ¬„ä½è¡¨å–®ï¼›  
    â€¢ feat: æ”¯æ´ç”¢å“åœ–ç‰‡ç¶²å€æˆ–æª”æ¡ˆä¸Šå‚³ï¼›  
    â€¢ bump: ç‰ˆæœ¬è‡ªå‹•æ›´æ–°ç‚º v1.4.0  
  v1.3.1 (2025-04-30)
    â€¢ feat: å¼•å…¥ lz-string åº« â†’ æ”¯æ´ JSON å£“ç¸®/è§£å£“
    â€¢ feat: ç”¢ç”Ÿ QR æ™‚ compressToBase64() â†’ é€¾å®¹é‡å† fallback è‡³åŸ Base64
    â€¢ fix: å®¹é‡æª¢æŸ¥æ”¹å° æœ€çµ‚ b64.lengthï¼ˆVersion 40-M ä¸Šé™ 2 953 bytesï¼‰
    â€¢ fix: è¼‰å…¥æµç¨‹å…ˆ decompressFromBase64() â†’ å¤±æ•—å† atob()ï¼Œä¸¦ æ­£ç¢ºå›å¡«è¡¨å–®æ¬„ä½
    â€¢ feat: File System Access API å„²å­˜ï¼›ä¸æ”¯æ´æ™‚è‡ªå‹•è½‰å‚³çµ±ä¸‹è¼‰
    â€¢ refactor: DOMContentLoaded ä¸­çµ±ä¸€åˆå§‹åŒ– QRiousï¼äº‹ä»¶ç¶å®š
    â€¢ docs: æ›´æ–°é é¦–èªªæ˜è‡³ v1.3.1ï¼Œè£œå……å¿«é€Ÿæµç¨‹èˆ‡ç¶­è­·è¦é»
  v1.2.0 (2025-04-29)
    â€¢ æ–°å¢ï¼šQR Code å„²å­˜åŠŸèƒ½ï¼ˆFile System Access API + å‚³çµ±ä¸‹è¼‰ï¼‰
    â€¢ æ–°å¢ï¼šQR Code è¼‰å…¥åŠŸèƒ½ï¼ˆæª”æ¡ˆé¸æ“‡å™¨è§£æå¡«è¡¨ï¼‰
    â€¢ ä¿®æ­£ï¼šæå‡è¼‰å…¥å¯é åº¦ï¼Œå®Œå–„éŒ¯èª¤è™•ç†ã€‚
    â€¢ å„ªåŒ–ï¼šæ›´æ–°ä½¿ç”¨èªªæ˜èˆ‡æ“ä½œæµç¨‹ã€‚
===============================================================================
-->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å“èŒ¶ QR Code ç®¡ç†ç³»çµ±</title>

<!-- -------------------------------------------------
 å­—é«”èˆ‡ç¬¬ä¸‰æ–¹å‡½å¼åº«
-------------------------------------------------- -->
<!-- ADD: é é€£ç·šä»¥åŠ é€Ÿå­—é«”è¼‰å…¥ -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- -------------------------------------------------
 å¼•å…¥ QRious, Html5Qrcode åŠ LZ-Stringï¼ˆULTIMATE UPDATE [1]ï¼‰
-------------------------------------------------- -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js" defer></script>
<script src="https://unpkg.com/html5-qrcode@2.3.7/html5-qrcode.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js" defer></script> <!-- ULTIMATE: å£“ç¸®æ”¯æŒ -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>

<!-- -------------------------------------------------
 è‡ªè¨‚æ¨£å¼ï¼šèŒ¶è‘‰é…è‰² ï¼‹ å¡ç‰‡é™°å½± ï¼‹ å‹•ç•«
-------------------------------------------------- -->
<style>
  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  /* ä¸»é¡Œè‰²ç¥¨ (é›†ä¸­ç®¡ç†ï¼Œä¾¿æ–¼ä¸€éµæ›è‰²) */
  :root {
    --tea-primary:       #5a7d2c;   /* ä¸»è‰² */
    --tea-primary-dark:  #496724;   /* æ‡¸æµ®ã€äº’å‹•è‰² */
    --tea-secondary:     #d4c3a0;   /* æ¬¡è‰² / åˆ†é èƒŒæ™¯ */
    --tea-bg:            #f9f7f2;   /* é é¢èƒŒæ™¯ */
    --tea-text:          #3f3320;   /* æ–‡å­—è‰² */
    --bs-primary: var(--tea-primary);
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  /* å…¨åŸŸæ¨£å¼ */
  body {
    font-family: 'Noto Serif TC', serif;
    background: linear-gradient(135deg, var(--tea-bg), #fff);
    color: var(--tea-text);
    margin: 0; padding: 0;
  }
  h3, h4, h5 {
    font-family: 'Playfair Display', serif;
    margin-top: 1rem; margin-bottom: 1rem;
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  /* å°è¦½åˆ— */
  .navbar {
    background: var(--tea-primary);
  }
  .navbar-brand {
    color: #fff !important;
    font-weight: 600;
    letter-spacing: 1px;
    transition: opacity 0.3s;
  }
  .navbar-brand:hover {
    opacity: 0.85;
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  /* åˆ†é æ¨™ç±¤ */
  .nav-tabs .nav-link {
    border: 0;
    font-weight: 600;
    color: var(--tea-text);
  }
  .nav-tabs .nav-link.active {
    background: var(--tea-secondary);
    color: var(--tea-text);
    border-radius: 0.5rem 0.5rem 0 0;
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  /* å¡ç‰‡ (Bootstrap .card è¦†å¯«) */
  .card {
    border: 0;
    border-radius: 1rem;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    background: #fff;
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  /* æŒ‰éˆ•  */
  .btn-primary {
    background: var(--tea-primary);
    border-color: var(--tea-primary);
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .btn-primary:hover {
    background: var(--tea-primary-dark);
    border-color: var(--tea-primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.12);
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  /* QR Canvas */
  #qr-code {
    display: block;
    margin: 2rem auto;
    border: 8px solid #fff;
    border-radius: 0.75rem;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  /* Debug å€å¡Š */
  .debug-wrapper summary {
    cursor: pointer;
    font-weight: 600;
    color: var(--tea-primary-dark);
  }
  pre.debug {
    background: #fff;
    border: 1px solid #e6e2d9;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    max-height: 200px;
    overflow: auto;
    padding: 0.75rem;
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  /* é€²å ´å‹•ç•« (åˆ†é åˆ‡æ›å¡ç‰‡) */
  @keyframes fadeInUp {
    0% {
      opacity: 0;
      transform: translateY(20px);
    }
    100% {
      opacity: 1;
      transform: none;
    }
  }
  .tab-pane.fade.show.active > .card {
    animation: fadeInUp 0.5s ease-out;
  }
</style>
</head>
<body>
  <main>
    <!-- å°è¦½åˆ— -->
    <nav class="navbar shadow-sm">
      <div class="container">
        <a class="navbar-brand" href="#">å“èŒ¶ QR Code ç®¡ç†ç³»çµ±</a>
      </div>
    </nav>

    <div class="container my-5">
      <!-- åˆ†é é¸å–® -->
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#gen">
            ç”¢ç”Ÿ QR Code
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link" data-bs-toggle="tab" data-bs-target="#scan">
            æƒæ QR Code
          </button>
        </li>
      </ul>

      <div class="tab-content py-4">
        <!-- â–º ç”¢ç”Ÿ QR Code åˆ†é  -->
        <div class="tab-pane fade show active" id="gen">
          <div class="card p-4">
            <h3 class="mb-3">èŒ¶è‘‰è³‡è¨Šè¼¸å…¥ (å…± 26 é …)</h3>
            <form id="teaForm">
              <div class="row g-3">
                <!-- 1â€“5 -->
                <div class="col-md-6">
                  <label for="teaName" class="form-label">1. èŒ¶è‘‰åç¨±</label>
                  <input id="teaName" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šæ—¥æœˆæ½­ç´…èŒ¶" required>
                </div>
                <div class="col-md-6">
                  <label for="teaType" class="form-label">2. èŒ¶è‘‰ç¨®é¡</label>
                  <input id="teaType" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šç´…èŒ¶">
                </div>
                <div class="col-md-6">
                  <label for="originRegion" class="form-label">3. ç”¢å€</label>
                  <input id="originRegion" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šå—æŠ•ç¸£é­šæ± é„‰">
                </div>
                <div class="col-md-6">
                  <label for="producer" class="form-label">4. ç”Ÿç”¢è€…</label>
                  <input id="producer" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šèŒ¶å±±è¾²å ´">
                </div>
                <div class="col-md-4">
                  <label for="harvestSeason" class="form-label">5. æ¡æ”¶å­£ç¯€</label>
                  <input id="harvestSeason" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šæ˜¥å­£">
                </div>

                <!-- 6â€“10 -->
                <div class="col-md-4">
                  <label for="harvestDate" class="form-label">6. æ¡æ‘˜æ—¥æœŸ</label>
                  <input id="harvestDate" class="form-control" type="date">
                </div>
                <div class="col-md-4">
                  <label for="processingMethod" class="form-label">7. è™•ç†æ–¹å¼</label>
                  <input id="processingMethod" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šçƒ˜ç„™">
                </div>
                <div class="col-md-4">
                  <label for="grade" class="form-label">8. ç­‰ç´š</label>
                  <input id="grade" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šç‰¹ç´š">
                </div>
                <div class="col-md-4">
                  <label for="batchNo" class="form-label">9. æ‰¹è™Ÿ</label>
                  <input id="batchNo" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼š202504A01">
                </div>
                <div class="col-md-4">
                  <label for="packagingDate" class="form-label">10. åŒ…è£æ—¥æœŸ</label>
                  <input id="packagingDate" class="form-control" type="date">
                </div>

                <!-- 11â€“15 -->
                <div class="col-md-6">
                  <label for="netWeight" class="form-label">11. æ·¨é‡ (g)</label>
                  <input id="netWeight" class="form-control" type="number" step="0.01" placeholder="ä¾‹å¦‚ï¼š50">
                </div>
                <div class="col-md-6">
                  <label for="moistureContent" class="form-label">12. æ°´åˆ†å«é‡ (%)</label>
                  <input id="moistureContent" class="form-control" type="number" step="0.1" placeholder="ä¾‹å¦‚ï¼š5.5">
                </div>
                <div class="col-md-6">
                  <label for="aromaProfile" class="form-label">13. é¦™æ°£</label>
                  <input id="aromaProfile" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šèŠ±é¦™ã€æœé¦™">
                </div>
                <div class="col-md-6">
                  <label for="flavorNotes" class="form-label">14. é¢¨å‘³æè¿°</label>
                  <input id="flavorNotes" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šç”˜é†‡å›ç”˜">
                </div>
                <div class="col-md-6">
                  <label for="infusionCount" class="form-label">15. å»ºè­°æ²–æ³¡æ¬¡æ•¸</label>
                  <input id="infusionCount" class="form-control" type="number" placeholder="ä¾‹å¦‚ï¼š3">
                </div>

                <!-- 16â€“20 -->
                <div class="col-md-6">
                  <label for="recommendedRatio" class="form-label">16. å»ºè­°æŠ•èŒ¶é‡ (g/L)</label>
                  <input id="recommendedRatio" class="form-control" type="number" step="0.1" placeholder="ä¾‹å¦‚ï¼š5">
                </div>
                <div class="col-md-4">
                  <label for="waterTemp" class="form-label">17. æ°´æº« (â„ƒ)</label>
                  <input id="waterTemp" class="form-control" type="number" placeholder="ä¾‹å¦‚ï¼š90">
                </div>
                <div class="col-md-4">
                  <label for="brewTime" class="form-label">18. æ²–æ³¡æ™‚é–“ (ç§’)</label>
                  <input id="brewTime" class="form-control" type="number" placeholder="ä¾‹å¦‚ï¼š30">
                </div>
                <div class="col-md-4">
                  <label for="servingSuggestion" class="form-label">19. å»ºè­°é£²ç”¨æ–¹å¼</label>
                  <input id="servingSuggestion" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šç†±é£²ã€æº«é£²">
                </div>
                <div class="col-md-6">
                  <label for="caffeineLevel" class="form-label">20. å’–å•¡å› å«é‡</label>
                  <input id="caffeineLevel" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šä¸­ç­‰">
                </div>

                <!-- 21â€“26 (åœ–ç‰‡æ”¯æ´ URL æˆ– æª”æ¡ˆ) -->
                <div class="col-md-6">
                  <label for="pHValue" class="form-label">21. pH å€¼</label>
                  <input id="pHValue" class="form-control" type="number" step="0.01" placeholder="ä¾‹å¦‚ï¼š6.5">
                </div>
                <div class="col-md-6">
                  <label for="storage" class="form-label">22. ä¿å­˜æ–¹å¼</label>
                  <input id="storage" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šé™°æ¶¼ä¹¾ç‡¥è™•">
                </div>
                <div class="col-md-6">
                  <label for="shelfLife" class="form-label">23. è³å‘³æœŸé™</label>
                  <input id="shelfLife" class="form-control" type="date">
                </div>
                <div class="col-md-6">
                  <label for="certification" class="form-label">24. èªè­‰</label>
                  <input id="certification" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šæœ‰æ©Ÿã€GAP">
                </div>
                <div class="col-md-6">
                  <label for="packagingType" class="form-label">25. åŒ…è£æ–¹å¼</label>
                  <input id="packagingType" class="form-control" type="text" placeholder="ä¾‹å¦‚ï¼šé‹ç®”è¢‹">
                </div>
                <div class="col-md-12">
                  <label for="productImageUrl" class="form-label">26. ç”¢å“åœ–ç‰‡ URL</label>
                  <input id="productImageUrl" class="form-control" type="url" placeholder="ä¾‹å¦‚ï¼šhttps://ä¾‹å­.com/tea.jpg">
                </div>
                <div class="col-md-12">
                  <label for="productImageFile" class="form-label">ç”¢å“åœ–ç‰‡ä¸Šå‚³</label>
                  <input id="productImageFile" class="form-control" type="file" accept="image/*">
                </div>
              </div>

              <button type="submit" class="btn btn-primary px-4 mt-4">
                ç”¢ç”Ÿ QR Code
              </button>
            </form>

            <!-- QR é¡¯ç¤ºèˆ‡æ“ä½œæŒ‰éˆ• -->
            <div class="text-center my-4">
              <canvas id="qr-code" width="420" height="420"></canvas>
              <div id="qr-reader-file" style="display:none;"></div>
              <div class="mt-4">
                <button id="save-btn" class="btn btn-secondary mx-2">å„²å­˜ QR Code</button>
                <button id="load-btn" class="btn btn-secondary">è¼‰å…¥ QR Code</button>
              </div>
            </div>

            <!-- Debug è³‡è¨Š -->
            <details class="debug-wrapper">
              <summary>Debug è³‡è¨Š â†¡</summary>
              <pre id="orig-payload" class="debug mt-2"></pre>
              <pre id="b64-payload" class="debug mt-2"></pre>
            </details>
          </div>
        </div>

        <!-- â–º æƒæ QR Code åˆ†é  -->
        <div class="tab-pane fade" id="scan">
          <div class="card p-4">
            <h3 class="mb-3">QR Code æƒæ</h3>
            <p class="text-muted">é»æ“Šå¾Œæˆæ¬Šç›¸æ©Ÿï¼Œå°æº– QR å³å¯ã€‚</p>
            <div id="reader" style="width:100%;max-width:600px;margin:auto;"></div>
            <hr>
            <div id="result"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

<!-- -------------------------------------------------
 JavaScript å€ï¼šç”¢ç”Ÿ + æƒæ
-------------------------------------------------- -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 1. åˆå§‹åŒ– QRious
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const qr = new QRious({
      element: document.getElementById('qr-code'),
      size: 420,
      level: 'M'  // QR å®¹éŒ¯ç­‰ç´š M (â‰ˆ3KB å®¹é‡)
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 2. æ¬„ä½ & æ¨™ç±¤å°æ‡‰
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const fields = [
      'teaName','teaType','originRegion','producer','harvestSeason',
      'harvestDate','processingMethod','grade','batchNo','packagingDate',
      'netWeight','moistureContent','aromaProfile','flavorNotes','infusionCount',
      'recommendedRatio','waterTemp','brewTime','servingSuggestion','caffeineLevel',
      'pHValue','storage','shelfLife','certification','packagingType'
    ];
    const labelMap = {
      teaName: 'èŒ¶è‘‰åç¨±', teaType: 'èŒ¶è‘‰ç¨®é¡', originRegion: 'ç”¢å€',
      producer: 'ç”Ÿç”¢è€…', harvestSeason: 'æ¡æ”¶å­£ç¯€', harvestDate: 'æ¡æ‘˜æ—¥æœŸ',
      processingMethod: 'è™•ç†æ–¹å¼', grade: 'ç­‰ç´š', batchNo: 'æ‰¹è™Ÿ',
      packagingDate: 'åŒ…è£æ—¥æœŸ', netWeight: 'æ·¨é‡', moistureContent: 'æ°´åˆ†å«é‡',
      aromaProfile: 'é¦™æ°£', flavorNotes: 'é¢¨å‘³æè¿°', infusionCount: 'å»ºè­°æ²–æ³¡æ¬¡æ•¸',
      recommendedRatio: 'å»ºè­°æŠ•èŒ¶é‡', waterTemp: 'æ°´æº«', brewTime: 'æ²–æ³¡æ™‚é–“',
      servingSuggestion: 'å»ºè­°é£²ç”¨æ–¹å¼', caffeineLevel: 'å’–å•¡å› å«é‡',
      pHValue: 'pH å€¼', storage: 'ä¿å­˜æ–¹å¼', shelfLife: 'è³å‘³æœŸé™',
      certification: 'èªè­‰', packagingType: 'åŒ…è£æ–¹å¼', productImage: 'ç”¢å“åœ–ç‰‡'
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 3. é¡é ­é è¨­
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function defaultCamId(cameras) {
      // å„ªå…ˆé¸æ“‡æ¨™ç±¤å« rear/back/å¾Œ çš„é¡é ­
      const rear = cameras.find(c => /rear|back|å¾Œ/.test(c.label));
      return (rear || cameras[0]).id;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 4. ç”¢ç”Ÿ QR Codeï¼ˆè¡¨å–® submitï¼‰
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('teaForm').addEventListener('submit', e => {
      e.preventDefault();

      // æ”¶é›†è¡¨å–®è³‡æ–™
      const data = {};
      fields.forEach(id => {
        const el = document.getElementById(id);
        if (el && el.value.trim()) data[id] = el.value.trim();
      });

      // åœ–ç‰‡ï¼šå„ªå…ˆ URLï¼Œå†æª”æ¡ˆ
      const url = document.getElementById('productImageUrl').value.trim();
      const file = document.getElementById('productImageFile').files[0];

      // æœ€çµ‚å°åŒ…èˆ‡ QR ç”Ÿæˆ
      const finalize = payload => {
        const jsonStr = JSON.stringify(payload);
        // å…ˆç”¨ LZString å£“ç¸®
        let b64 = LZString.compressToBase64(jsonStr);
        // è¶…é™å°± fallback è‡³åŸç”Ÿ Base64
        if (b64.length >= 2953) {
          b64 = btoa(unescape(encodeURIComponent(jsonStr)));
        }
        if (b64.length > 2953) {
          alert(`è³‡æ–™éé•· (${b64.length} bytes)ï¼Œè«‹ç²¾ç°¡å…§å®¹ã€‚`);
          return;
        }
        qr.value = b64;
        // é¡¯ç¤º Debug è³‡è¨Š
        document.getElementById('orig-payload').textContent = jsonStr;
        document.getElementById('b64-payload').textContent = b64;
      };

      // å¡«å…¥åœ–ç‰‡è³‡æ–™
      if (url) {
        finalize({ ...data, productImage: url });
      }
      else if (file) {
        const reader = new FileReader();
        reader.onload = () => finalize({ ...data, productImage: reader.result });
        reader.readAsDataURL(file);
      }
      else {
        finalize(data);
      }
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 5. æƒæ QR Codeï¼ˆåˆ‡æ›è‡³æƒæåˆ†é æ™‚åˆå§‹åŒ–ï¼‰
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let scanner = null;
    const scanTabBtn = document.querySelector('button[data-bs-target="#scan"]');

    scanTabBtn.addEventListener('shown.bs.tab', () => {
      if (scanner) return;  // å·²ç¶“åˆå§‹åŒ–éå°±è·³é

      // å»ºæ§‹ Html5QrcodeScanner
      scanner = new Html5QrcodeScanner(
        "reader",
        {
          fps: 12,                              // æƒæå¹€ç‡
          qrbox: { width: 300, height: 300 },   // é¡¯ç¤ºä¸¦æƒæçš„æ¡†å¤§å°
          disableFlip: true,                    // é—œé–‰ç¿»è½‰
          rememberLastUsedCamera: true,         // è¨˜ä½ä½¿ç”¨éçš„ç›¸æ©Ÿ
          experimentalFeatures: {
            useBarCodeDetectorIfSupported: true // å¦‚æœæœ‰ BarcodeDetector API å°±ç”¨å®ƒ
          },
          defaultCameraId: defaultCamId         // å…ˆå‰å®šç¾©çš„é¡é ­é¸æ“‡å‡½å¼
        },
        /* verbose= */ false
      );

      // æƒææˆåŠŸå›å‘¼
      const onScanSuccess = decodedText => {
        try {
          // å…ˆå˜—è©¦ LZString è§£å£“ï¼Œå¤±æ•—å°±ç”¨ atob
          let raw = LZString.decompressFromBase64(decodedText);
          if (!raw) raw = decodeURIComponent(escape(atob(decodedText)));
          const info = JSON.parse(raw);

          // çµ„ç•«é¢
          let html = '<h4 class="mb-3">èŒ¶è‘‰è³‡è¨Š</h4><ul class="list-group mb-3">';
          Object.entries(info).forEach(([k, v]) => {
            const lbl = labelMap[k] || k;
            if (k === 'productImage') {
              html += `
                <li class="list-group-item">
                  <strong>${lbl}ï¼š</strong><br>
                  <img src="${v}" class="img-fluid rounded mt-2">
                </li>`;
            } else {
              html += `
                <li class="list-group-item d-flex justify-content-between">
                  <span>${lbl}</span><span>${v}</span>
                </li>`;
            }
          });
          html += '</ul>';
          document.getElementById('result').innerHTML = html;

          // å¦‚æœä½ åªæƒ³æƒä¸€æ¬¡ï¼Œå‰‡å¯ä»¥åœæ­¢æƒæï¼š
          // scanner.clear().catch(err => console.warn('åœæ­¢æƒæå¤±æ•—', err));
        } catch (e) {
          document.getElementById('result').innerHTML =
            `<div class="alert alert-danger">è§£æéŒ¯èª¤ï¼š${e.message}</div>`;
        }
      };

      // æƒæéŒ¯èª¤å›å‘¼ï¼ˆå¯ä»¥å°å‡ºä¾†çœ‹çœ‹ç‚ºä»€éº¼æ²’è§£åˆ°ç¢¼ï¼‰
      const onScanError = errorMessage => {
        console.debug('QR æƒæéŒ¯èª¤ï¼š', errorMessage);
      };

      // é–‹å§‹æƒæï¼ˆå¸¶å…¥æˆåŠŸèˆ‡éŒ¯èª¤å›å‘¼ï¼‰
      scanner.render(onScanSuccess, onScanError);
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 6. å„²å­˜ QR Code åœ–ç‰‡
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('save-btn').addEventListener('click', async () => {
      try {
        // ç›´æ¥å–å¾— canvas å…ƒç´ 
        const canvas = document.getElementById('qr-code');
        // å°‡ canvas è½‰ç‚º blob
        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
        const defaultName = (document.getElementById('teaName').value.trim() || 'qr-code') + '.png';

        if (window.showSaveFilePicker) {
          const handle = await showSaveFilePicker({
            suggestedName: defaultName,
            types: [{
              description: 'PNG åœ–ç‰‡',
              accept: { 'image/png': ['.png'] }
            }]
          });
          const writable = await handle.createWritable();
          await writable.write(blob);
          await writable.close();
        } else {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = defaultName;
          a.click();
          URL.revokeObjectURL(url);
        }
      } catch (err) {
        alert('å„²å­˜å¤±æ•—ï¼š' + err.message);
      }
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 7. è¼‰å…¥ QR Codeï¼ˆå¾æª”æ¡ˆï¼‰
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('load-btn').addEventListener('click', () => {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = e => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new Html5Qrcode('qr-reader-file');
        reader.scanFile(file, true)
          .then(decodedText => {
            let raw = LZString.decompressFromBase64(decodedText);
            if (!raw) raw = decodeURIComponent(escape(atob(decodedText)));
            const info = JSON.parse(raw);

            // å›å¡«è¡¨å–®
            Object.entries(info).forEach(([k, v]) => {
              const el = document.getElementById(k);
              if (el) el.value = v;
            });

            // æ›´æ–°ç•«é¢ QRï¼ˆä»¥ç´” Base64 å†ç”¢ç”Ÿï¼‰
            const jsonStr = JSON.stringify(info);
            qr.value = btoa(unescape(encodeURIComponent(jsonStr)));
            reader.clear();
          })
          .catch(err => {
            alert('è¼‰å…¥å¤±æ•—ï¼š' + err);
            reader.clear();
          });
      };
      input.click();
    });

  }); // end DOMContentLoaded
</script>
</body>
</html>
